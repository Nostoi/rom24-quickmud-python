- Use `rg` for code searches; never run `grep -R`.
- Quote paths with spaces (e.g., `src/'QuickMUD Fixes'`).
- Update `doc/c_module_inventory.md` whenever C modules are added or removed.
- Always run `pytest` before committing.
- Maintain `doc/python_module_inventory.md` when Python modules change; keep C feature mapping current.
- Keep `doc/c_python_cross_reference.md` updated when subsystems move from C to Python.
- Maintain JSON schemas under `schemas/`; revise them whenever data formats change.
- Keep `schemas/character.schema.json` aligned with `char_data` structure; include new stats or flags immediately.
- Keep `schemas/object.schema.json` aligned with `OBJ_DATA`; update wear flags and value slots when they change.
- Keep `schemas/area.schema.json` aligned with `AREA_DATA`; capture vnum ranges and builder lists precisely.
- Validate every JSON schema with `jsonschema` tests; update tests when schemas change.
- Always convert `.are` files using `mud/scripts/convert_are_to_json.py`; never handcraft JSON.
- Clear registries before conversions to avoid leaking data between areas.
- Store converted area JSON under `data/areas/`; name files after the source `.are`.
- Verify converted area JSON preserves room, mob, and object counts; tests must compare against source `.are` files.
- Mirror each JSON schema with a `*_json.py` dataclass; update `mud/models/__init__.py` and `mud/models/README.md` when adding one.
- Enumerate C subsystems in `PYTHON_PORT_PLAN.md`; never begin porting a module without a corresponding plan entry.
- Mirror every new JSON schema with a `*_json.py` dataclass and export it via `mud/models/__init__.py`; update `mud/models/README.md` and tests immediately.
- Run mypy with `--follow-imports=skip` on targeted modules to avoid unrelated type errors.
- Ensure schema defaults mirror dataclass defaults; test instantiation to catch mismatches.

- Convert `#SHOPS` sections with `convert_shops_to_json.py`; map item type numbers to `ItemType` names and skip zeros.
- Cross-check converted table counts with source files; fail tests on mismatches.
- Make every schema dataclass subclass `JsonDataclass`; never hand-roll JSON serialization.
- Stop cloning `merc.h` structs; favor schema dataclasses like `ResetJson` in loaders and handlers.
- Create runtime dataclasses mirroring each schema; never operate on JSON dataclasses inside the engine.
- Reset ticks must clear mobs and objects before reapplying area resets.
- Test reset scheduler with ticks to ensure repop occurs when areas empty.
- Drive command dispatch through a Command dataclass; match unique prefixes and block admin-only commands in dispatcher.
- Use shlex.split for argument parsing; reject ambiguous abbreviations as unknown commands.
- Force hits or misses by cranking hitroll; don't seed global RNG in tests.
- Flip positions: set both to FIGHTING on swing, set victim DEAD and attacker STANDING when killing.
- Drive all skill usage through `skill_registry`; never hard-code spell lists.
- Inject RNG into `SkillRegistry` for deterministic failure tests.
- Level ups must call `advance_level`; never adjust `level` without stat gains.
- Practice and train commands must consume sessions and validate targets.
- Shop prices must use `shop.profit_buy`/`shop.profit_sell`; never charge raw object cost.
- Write player saves atomically: dump to a temp file and `os.replace`.
- Strip `comm.c`, `nanny.c`, and `telnet.h` once networking moves to Python; update inventories and cross-reference docs immediately.
- Translate ROM color tokens with `translate_ansi` before sending to clients; never emit raw `{` codes.
- In telnet tests with multiple clients, wait for prompts to flush broadcast messages.
- Route global channel messages through `broadcast_global`; respect `muted_channels` and block senders with `banned_channels`.
- Clear `character_registry` in tests that inspect channel broadcasts to avoid cross-test contamination.
- Persist boards to `data/boards` using atomic writes and `os.replace`; never write directly to the final JSON file.
- Override `notes.BOARDS_DIR` in tests to isolate board data and reload `board_registry` between cases.
- Register new commands like `note` and `board` in the dispatcher; keep the command table authoritative.
- Represent mobprog triggers with `IntFlag` in `mobprog.py`; match trigger bits with `MobProgram.trig_type`.
- `run_prog` must filter by trigger and phrase and return executed actions for tests.
- Interpreter supports only `say` and `emote`; ignore other commands for now.
- Mark OLC commands admin_only and parse args with shlex.split to handle spaces.
- Central update_tick must call regen_tick, weather_tick, event_tick, and reset_tick every loop.
- Login handshake must ask for username, password, then char name; reject unknown chars.
- Hash passwords with bcrypt; never store raw or SHA hashes.
- Wait for '> ' prompt after each telnet command in scripted sessions; never read partial output.
- CI must lint and type-check core modules with ruff, flake8, and mypy, and run pytest; install bcrypt and jsonschema in workflows.
- Enforce at least 80% coverage in CI using `pytest --cov`; skip `test_scripted_session.py` during coverage and run it separately.
- Purge the legacy `src/` tree and makefiles; never reintroduce C sources.
